<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompt - AI Drawing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white rounded-lg shadow-xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ðŸŽ¨ Teleprompt</h1>
                <p class="text-gray-600">AI-powered drawing game with friends</p>
            </div>

            <form id="joinForm" class="space-y-4">
                <div>
                    <label for="playerName" class="block text-sm font-medium text-gray-700 mb-2">Your Name</label>
                    <input type="text" id="playerName" name="playerName" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Enter your name" required>
                </div>

                <div>
                    <label for="roomCode" class="block text-sm font-medium text-gray-700 mb-2">Room Code</label>
                    <input type="text" id="roomCode" name="roomCode" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Enter room code" required>
                </div>

                <button type="submit" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                    Join Game
                </button>
            </form>

            <div class="mt-6 text-center">
                <button id="createRoomBtn" 
                        class="text-blue-600 hover:text-blue-800 font-medium">
                    Create New Room
                </button>
            </div>

            <div id="status" class="mt-4 text-center text-sm text-gray-600 hidden"></div>
        </div>

            <div id="gameInfo" class="max-w-md mx-auto mt-4 bg-white rounded-lg shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Players in Room</h3>
                <div id="playersList" class="space-y-2"></div>
                <div id="gameStatus" class="mt-4 text-center text-sm text-gray-600"></div>
                <div id="startGameSection" class="mt-4 hidden">
                    <button id="startGameBtn" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                        Start Game Now
                    </button>
                    <p class="text-xs text-gray-500 text-center mt-2">Room creator can start with any number of players</p>
                </div>
            </div>
    </div>

    <script>
        const socket = io();
        let currentRoom = null;
        let playerName = null;
        let isRoomCreator = false;

        // Generate random room code
        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // Join room
        function joinRoom(name, room) {
            playerName = name;
            currentRoom = room;
            socket.emit('join_room', {
                player_name: name,
                room_code: room,
                is_creator: isRoomCreator
            });
        }

        // Form submission
        document.getElementById('joinForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('playerName').value.trim();
            const room = document.getElementById('roomCode').value.trim().toUpperCase();
            
            if (name && room) {
                isRoomCreator = false; // Reset creator status when joining existing room
                joinRoom(name, room);
            }
        });

        // Create new room
        document.getElementById('createRoomBtn').addEventListener('click', function() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('Please enter your name first');
                return;
            }
            
            const newRoom = generateRoomCode();
            document.getElementById('roomCode').value = newRoom;
            isRoomCreator = true; // Mark as room creator
            joinRoom(name, newRoom);
        });

        // Start game button
        document.getElementById('startGameBtn').addEventListener('click', function() {
            if (isRoomCreator && currentRoom) {
                socket.emit('start_game_manual', {
                    room_code: currentRoom,
                    player_name: playerName
                });
            }
        });

        // Socket event listeners
        socket.on('player_joined', function(data) {
            document.getElementById('status').textContent = `Joined room as ${data.player_name}`;
            document.getElementById('status').classList.remove('hidden');
            
            // Update room creator status
            if (data.is_creator !== undefined) {
                isRoomCreator = data.is_creator;
            }
            
            updatePlayersList(data.players);
            updateGameStatus(data.ready_to_start);
        });

        socket.on('player_list_updated', function(data) {
            updatePlayersList(data.players);
            updateGameStatus(data.ready_to_start);
        });

        socket.on('player_left', function(data) {
            updatePlayersList(data.players);
            updateGameStatus(data.ready_to_start);
        });

        socket.on('room_full', function(data) {
            alert(data.message);
        });

        socket.on('game_started', function(data) {
            window.location.href = `/game/${currentRoom}`;
        });

        socket.on('error', function(data) {
            alert(data.message);
        });

        function updatePlayersList(players) {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            
            players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'flex items-center space-x-2 p-2 bg-gray-50 rounded-md';
                playerDiv.innerHTML = `
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-gray-700">${player}</span>
                `;
                playersList.appendChild(playerDiv);
            });
            
            document.getElementById('gameInfo').classList.remove('hidden');
        }

        function updateGameStatus(readyToStart) {
            const statusDiv = document.getElementById('gameStatus');
            const startGameSection = document.getElementById('startGameSection');
            const playerCount = document.getElementById('playersList').children.length;
            
            if (readyToStart) {
                statusDiv.textContent = 'Ready to start! Game will begin automatically...';
                statusDiv.className = 'mt-4 text-center text-sm text-green-600';
                startGameSection.classList.add('hidden');
            } else {
                statusDiv.textContent = `Waiting for players... (${playerCount}/4)`;
                statusDiv.className = 'mt-4 text-center text-sm text-gray-600';
                
                // Show start button for room creator if there are at least 2 players
                if (isRoomCreator && playerCount >= 2) {
                    startGameSection.classList.remove('hidden');
                } else {
                    startGameSection.classList.add('hidden');
                }
            }
        }
    </script>
</body>
</html>
